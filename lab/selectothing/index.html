<!DOCTYPE html>
<html>
<head>
  <style>
    body {
      position: relative;
      overflow-y: scroll;
    }
    .ripple,.ripple:before {
      display:block;
      border-radius: 2px;
      width: 0px;
      height: 0px;
      -webkit-animation:rip 0.2s linear;
    }

    @-webkit-keyframes rip {
      0%  {
        box-shadow:0 0 10px 0px #eee,
                   0 0 0 0 #eee,
                   0 0 0 0 #eee
      }
      20% {
        box-shadow:0 0 10px 0 #008bbf,
                   0 0 20px 0 rgba(255,255,255,0.2),
                   0 0 40px 0 #008bbf
      }
      100% {
        box-shadow:0 0 40px 10px #009fdf,
                   0 0 10px 20px transparent,
                   0 0 30px 30px #009fdf
      }
    }

    #log {
    border: 2px solid #555;
    border-radius: 2px 2px;
    height: 50px;
    width: 25%;
    margin-bottom: 20px;
    color: #4588af;
    text-align: center;
    padding: 12px 0px 5px 0px;
  }


  body.drag {
    cursor: pointer;
  }

  .square {
    height: 120px;
    background: #ff5567;
  }

  .selected {
    outline: 4px solid #333;
  }

  .col {
    float: left;
    width: 12.5%;
    margin-right: 20px;
  }

  .col:last-of-type {
    margin-right: 0px;
  }

  .grid {
    margin-bottom: 20px;
  }

  .grid:after {
    content: "";
    clear: both;
    display: table;
  }

  *, *:after, *:before {
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    outline: 0;
  }

  .click-point {
    position: fixed;
    overflow: visible;
    z-index: 100000;
    border: 3px solid #000;
    background: #009fdf;
    opacity: 0.4;
  }
</style>
</head>
<body>
  <div id="log"></div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
    <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>
  <div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div><div class="grid">
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
    <div class="square col selectable"></div>
  </div>

  <script>
    var SELECTED_CLASS = 'selected';
    var SCROLL_INCREMENT = 20;
    var TOLERANCE = 0.99;

    var totalScroll = 0;

    var mouseIsDown = false;
    var dragging = false;
    var point = null;
    // querySelectorAll returns a node list object, xform it into a standard array
    var selectableList = [].slice.call(document.querySelectorAll('.selectable'), 0);

    // Every time a new spot is clicked, until mouse is
    // released, we will create a new startVector object.
    var startVector = null;

    var pageHeight = document.body.offsetHeight;

    document.addEventListener('mousedown', onMouseDown);
    document.addEventListener('mouseup', onMouseUp);
    document.addEventListener('mousemove', onMouseMove);

    function log(message) {
      document.getElementById('log').textContent = message;
    }

    function cleanup() {
      document.removeEventListener('mousedown', onMouseDown);
      document.removeEventListener('mouseup', onMouseUp);
      document.removeEventListener('mousemove', onMouseMove);
    }

    function onMouseDown(event) {
      event.preventDefault();

      mouseIsDown = true;
      log('mouse is down at ' + event.x + ', ' + event.y, mouseIsDown);

// so every mouseclick is relative from the top of the window.  we should recenter the the screen position
// everytime we scroll then
      document.body.className = 'drag';


//    if (document.body.scrollTop) {
      //   makeClickPoint(event.pageX, event.pageY - document.body.scrollTop);
      //   startVector = new Vector(event.pageX, event.pageY - document.body.scrollTop);
      // } else {
        makeClickPoint(event.x, event.pageY);
        startVector = new Vector(event.x, event.y);
  //    }
    }

    function onMouseUp(event) {
      event.preventDefault();

      mouseIsDown = false;
      dragging = false;

      log('mouse is up.', mouseIsDown);

      document.body.className = '';
      totalScroll = 0;

      startVector = null;
      removePoint();
    }

    function onMouseMove(event) {
      if (!mouseIsDown) {
        return;
      }

      event.preventDefault();

      var x = event.x,
          y = event.y;

      dragging = true;

      console.log('scrollTop + y', event.y + document.body.scrollTop)
      console.log('scrollHeight', document.body.scrollHeight)

      shouldSelect(x, y);
      if ((event.y + document.body.scrollTop) >= document.body.scrollHeight) {
        totalScroll = 0;
      } else {
        shouldScroll(x,y);
      }



      if (document.body.scrollTop && (y > (TOLERANCE * window.innerHeight))) {
        console.log('Y=' + y)
        updatePoint(x, Math.abs(event.pageY - document.body.scrollTop));
      } else {
        updatePoint(x, y);
      }

      log(selectableList.filter(function(item) {
        return hasSelected(item);
      }).length + ' items selected.');
    }


    function shouldScroll(yPos) {
      var screenHeight = window.innerHeight;
      var yTolerance = TOLERANCE * screenHeight;

      if (yPos < yTolerance) {
        return;
      }

      if (document.body.scrollTop >= (TOLERANCE * (document.body.scrollHeight - screenHeight))) {
        totalScroll = 0;
        //point.style.position = 'fixed';
        return;
      }

      point.style.position = 'absolute';

      window.scrollBy(0, SCROLL_INCREMENT);
      totalScroll += SCROLL_INCREMENT;
    }

    function hasCollision(a, b) {
      var rect1 = a.getBoundingClientRect();
      var rect2 = b.getBoundingClientRect();

      if (rect1.left < rect2.left + rect2.width &&
          rect1.left + rect1.width > rect2.left &&
          rect1.top < rect2.top + rect2.height &&
          rect1.height + rect1.top > rect2.top) {
        return true;
      }

      return false;
    }

    function hasSelected(node) {
      return (new RegExp(SELECTED_CLASS).test(node.className));
    }

    function shouldSelect(x, y) {
      selectableList.forEach(function(item) {
        if (hasCollision(point, item)) {

          if (hasSelected(item)) {
            return;
          }

          item.className = item.className + ' ' + SELECTED_CLASS;
        } else {
          item.className = item.className.replace(' ' + SELECTED_CLASS, '');
        }
      });
    }

    function makeClickPoint(x, y) {
      var isPoint = document.querySelector('.click-point');

      var scrollTop = document.body.scrollTop;
      var height = window.innerHeight;

      point = isPoint ? isPoint : document.createElement('span');
      point.className = 'click-point ripple';
      point.style.top  = y + 'px';
      point.style.left = x + 'px';
      point.style.position = "absolute"

      document.body.appendChild(point);
    }

    function removePoint() {
      document.body.removeChild(point);
      point = null;
    }

    function updatePoint(newX, newY) {
      newY = newY + totalScroll;

      if (newY >= document.body.scrollHeight) {
        return;
      }

    //  var scrollTop = document.body.scrollTop;

      //if (scrollTop) {
        //newY = scrollTop - newY;
      //}

      if (newX < startVector.x) {
        point.style.left = newX + 'px';
      }

      if (newY < startVector.y) {
        point.style.top = newY + 'px';
      }

      point.style.paddingRight = Math.abs(newX - startVector.x) + 'px';
      point.style.paddingBottom = Math.abs(newY - startVector.y) + 'px';
    }

    function Vector(x,y) {
      this.x = x;
      this.y = y;
    }

  </script>
</body>
</html>